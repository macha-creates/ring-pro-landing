<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ring PRO — Performance by design</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* Hide default cursor everywhere */
    * { cursor: none !important; }

    /* Square cursor — above everything */
    #cursor {
      position: fixed;
      width: 20px; height: 20px;
      border: 1px solid #000;
      pointer-events: none;
      transform: translate(-50%, -50%);
      z-index: 9999;
      background: transparent;
      transition: background 0.3s ease;
    }
    #cursor.expanded { background: #fff; z-index: 3; }
    /* Crosshair lines — behind text/CTA/bar */
    #cursor-lines {
      position: fixed;
      pointer-events: none;
      z-index: 9;
    }
    #cursor-lines span {
      position: absolute;
      background: #000;
      opacity: 0.1;
      transition: transform 0.4s ease;
    }
    /* transform-origin set to the FAR end so scaleX/Y(0) collapses from square outward */
    #cursor-lines .line-left  { right: 10px;  top: 0; width: 200vw; height: 1px; transform: translateY(-50%) scaleX(1); transform-origin: left center; }
    #cursor-lines .line-right { left: 10px;   top: 0; width: 200vw; height: 1px; transform: translateY(-50%) scaleX(1); transform-origin: right center; }
    #cursor-lines .line-up    { bottom: 10px; left: 0; width: 1px; height: 200vh; transform: translateX(-50%) scaleY(1); transform-origin: center top; }
    #cursor-lines .line-down  { top: 10px;    left: 0; width: 1px; height: 200vh; transform: translateX(-50%) scaleY(1); transform-origin: center bottom; }

    :root {
      --bar-h: 44px;
      --blue: #0882ff;
      --font: 'TWK Everett', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      --ui:   'Geist Mono', 'JetBrains Mono', monospace;
    }

    html, body { height: 100%; overflow: hidden; }
    html { font-family: var(--font); }
    body { background: #fff; }
    img  { display: block; }
    a    { color: inherit; }

    /* ─── ANNOUNCEMENT BAR ─── */
    .bar {
      position: fixed; top: 0; left: 0; right: 0; z-index: 10000;
      height: var(--bar-h);
      background: rgba(0,0,0,0.82);
      backdrop-filter: blur(47px); -webkit-backdrop-filter: blur(47px);
      display: flex; align-items: center; justify-content: center;
      font-family: 'Inter', sans-serif;
      font-size: 13px; color: #dadada; letter-spacing: -0.26px; gap: 4px;
    }
    .bar a { text-decoration: underline; color: #dadada; }

    /* ─── HERO ─── */
    .hero {
      position: relative;
      width: 100vw;
      height: calc(100vh - var(--bar-h));
      margin-top: var(--bar-h);
      background: transparent;
      overflow: hidden;
    }

    /* ── PRO title block ── */
    .hero__titles {
      position: absolute;
      top: 10.32%; left: 50%;
      transform: translateX(-50%);
      display: flex; flex-direction: column; align-items: center;
      gap: 3px;
      width: 17.5vw;
      z-index: 100;
    }
    /* Scale only the PRO logo image — width via container, height via scaleY */
    .hero__logo {
      width: 100%;
      transform: scaleY(0.4);
      transform-origin: top center;
      margin-bottom: -6vw;
    }
    .hero__logo img { width: 100%; height: auto; }
    .hero__tagline {
      font-size: clamp(10px, 1.1vw, 16px);
      font-weight: 400; letter-spacing: -0.72px;
      color: #000; text-align: center; line-height: 1; white-space: nowrap;
    }

    /* ── CTA — 10vh below the PRO text top + estimated scaled height ── */
    .hero__cta {
      position: absolute;
      top: calc(10.32% + 11vh);
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
    }
    .btn-buy {
      display: inline-flex; align-items: center; justify-content: center;
      padding: 12px 20px; min-width: 120px;
      background: var(--blue); color: #fff;
      border: none; border-radius: 40px;
      font-family: var(--ui); font-weight: 600; font-size: 14px;
      text-transform: uppercase; letter-spacing: 0.5px;
      cursor: pointer; text-decoration: none; white-space: nowrap;
    }

    /* ── Ring — Figma: 594×612px container, image offset w=170.03%, h=123.69% ── */
    .hero__ring {
      position: absolute;
      top: 44%; left: 50%;
      transform: translateX(-50%);
      width: 23.57vw;   /* 39.29vw × 0.6 */
      height: 24.29vw;  /* 40.48vw × 0.6 */
      z-index: 5;
    }
    .hero__ring-inner {
      position: absolute; inset: 0;
      overflow: hidden; pointer-events: none;
    }
    #ring-seq {
      position: absolute;
      inset: 0;
      width: 100%; height: 100%;
      display: block;
    }

    /* ── HOVER TEXT OVERLAY (difference blend — text + dots only) ── */
    .hover-text {
      position: absolute;
      left: 50%;
      top: calc(44% + 12.145vw);
      width: 0; height: 0;
      pointer-events: none;
      z-index: 21;
      opacity: 0;
      transition: opacity 0.3s ease;
      font-family: var(--ui);
      color: #fff;
      mix-blend-mode: difference;
    }
    .hover-text.active { opacity: 1; }

    /* ── HOVER INFO OVERLAY (no blend — accessories + colours) ── */
    .hover-info {
      position: absolute;
      left: 50%;
      top: calc(44% + 12.145vw);
      width: 0; height: 0;
      pointer-events: none;
      z-index: 20;
      opacity: 0;
      transition: opacity 0.3s ease;
      font-family: var(--ui);
      color: #000;
    }
    .hover-info.active { opacity: 1; }

    /* Red 8×8 square markers */
    .hi-dot {
      width: 8px; height: 8px;
      background: #ff3700;
      flex-shrink: 0;
    }

    /* Row wrapping dot + Ring PRO label — flex for true vertical centering */
    .hi-ring-row {
      position: absolute;
      left: calc(-11.785vw - 24px);
      top: calc(-12.145vw - 24px - 1vw);
      display: flex;
      align-items: center;
      gap: 2px;
    }

    /* "RING PRO" label */
    .hi-ring-label {
      font-size: clamp(8px, 0.6vw, 11px);
      font-weight: 500;
      letter-spacing: -0.6px;
      text-transform: uppercase;
      white-space: nowrap;
    }

    /* Spec texts — right of ring box, flush with top edge */
    .hi-specs {
      position: absolute;
      left: 15vw;
      top: calc(-12.145vw - 24px);
      display: flex;
      flex-direction: column;
      gap: 2.5vw;
      width: 12vw;
      font-size: clamp(7px, 0.55vw, 10px);
      text-transform: uppercase;
      line-height: 1.5;
    }

    /* Accessories — flush with bottom-left corner of main rectangle, no padding */
    .hi-acc {
      position: absolute;
      left: calc(-17.245vw - 44px);
      bottom: calc(-12.145vw - 24px);
      width: calc(5.46vw + 20px);
      font-size: clamp(8px, 0.6vw, 11px);
    }
    .hi-acc-header {
      display: flex; align-items: center; gap: 0.5vw;
      margin-bottom: 0.5vw;
      font-weight: 500;
      text-transform: uppercase;
      white-space: nowrap;
    }
    .hi-dot-inline {
      width: 8px; height: 8px;
      background: #ff3700;
      flex-shrink: 0;
    }
    .hi-charger-box {
      border: 1px solid #000;
      overflow: hidden;
      display: flex; flex-direction: column;
      height: calc(6.86vw + 20px);
      padding: 10px;
      background: #fff;
    }
    .hi-charger-img-area {
      flex: 1;
      display: flex; align-items: center; justify-content: center;
      overflow: hidden;
      padding-bottom: 10%;
    }
    .hi-charger-rotator { flex: none; }
    .hi-charger-clip {
      width: 5.46vw; height: 5.04vw;
      position: relative; overflow: hidden;
    }
    .hi-charger-clip img {
      position: absolute;
      width: 153.23%; height: 275.36%;
      left: -27.7%; top: -91.26%;
      max-width: none;
    }
    .hi-charger-bar {
      background: #000;
      height: 1.4vw; min-height: 15px;
      display: flex; align-items: center;
      padding: 0 0.8vw;
      flex-shrink: 0;
      gap: 0.4vw;
      /* escape the box's 10px padding to fill the full outlined width and sit flush at the bottom */
      margin: 0 -10px -10px -10px;
      width: calc(100% + 20px);
    }
    .hi-charger-bar > span {
      color: #fff;
      font-family: var(--ui);
      font-size: clamp(7px, 0.55vw, 10px);
      text-transform: uppercase;
      font-weight: 500;
      flex: 1;
      letter-spacing: 0.3px;
    }
    .hi-charger-arrow { color: #fff; font-size: 11px; line-height: 1; }

    /* Accessories label — sits above charger box in hover-text layer */
    .hi-acc-header-text {
      position: absolute;
      left: calc(-17.245vw - 44px);
      bottom: calc(-5.285vw - 4px);
      width: calc(5.46vw + 20px);
      white-space: nowrap;
      font-size: clamp(7px, 0.55vw, 10px);
      font-weight: 400;
    }

    /* Colours label — sits above colour grid in hover-text layer */
    .hi-colours-label-text {
      position: absolute;
      left: calc(11.785vw + 24px);
      top: 2.8vw;
      font-size: clamp(7px, 0.55vw, 10px);
      font-weight: 400;
      padding-left: calc(3.215vw - 19px);
    }

    /* Colours — right of ring box, lower (label moved to hover-text layer) */
    .hi-colours {
      position: absolute;
      left: calc(11.785vw + 24px);
      top: calc(2.8vw + 1.2vw);
      font-size: clamp(8px, 0.6vw, 11px);
    }
    .hi-colours-label {
      font-weight: 500;
      text-transform: uppercase;
      margin-bottom: 0.6vw;
      white-space: nowrap;
      padding-left: calc(3.215vw - 19px);
    }
    .hi-colour-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.3vw;
      width: 11.1vw;
    }
    .hi-colour-item {
      width: 5.4vw; height: 5vw;
      position: relative; overflow: hidden;
    }
    .hi-colour-item img {
      position: absolute;
      width: 100%; height: 106.52%;
      left: 0; top: -3.26%;
      max-width: none;
    }

    /* ── Difference blend — hero titles only on ring hover ── */
    .hero__titles.ring-hovered {
      mix-blend-mode: difference;
    }
    .hero__titles.ring-hovered .hero__tagline {
      color: #fff;
    }
    .hero__titles.ring-hovered .hero__logo img {
      filter: invert(1);
    }

    /* ── HOVER INFO enter animations (non-text elements only — text is driven by JS) ── */
    .hi-dot-tl      { opacity: 0; transform: scale(0); }
    .hi-charger-box { opacity: 0; transform: translateY(12px); }
    .hi-colour-item { opacity: 0; transform: scale(0.82); }

    .hover-text.active .hi-dot-tl {
      opacity: 1; transform: scale(1);
      transition: opacity 0.15s ease, transform 0.15s cubic-bezier(0.34,1.56,0.64,1);
    }
    .hover-info.active .hi-charger-box {
      opacity: 1; transform: translateY(0);
      transition: opacity 0.22s ease 0.1s, transform 0.22s ease 0.1s;
    }
    .hover-info.active .hi-colour-item:nth-child(1) {
      opacity: 1; transform: scale(1);
      transition: opacity 0.15s ease 0.12s, transform 0.15s cubic-bezier(0.34,1.56,0.64,1) 0.12s;
    }
    .hover-info.active .hi-colour-item:nth-child(2) {
      opacity: 1; transform: scale(1);
      transition: opacity 0.15s ease 0.18s, transform 0.15s cubic-bezier(0.34,1.56,0.64,1) 0.18s;
    }
    .hover-info.active .hi-colour-item:nth-child(3) {
      opacity: 1; transform: scale(1);
      transition: opacity 0.15s ease 0.24s, transform 0.15s cubic-bezier(0.34,1.56,0.64,1) 0.24s;
    }
    .hover-info.active .hi-colour-item:nth-child(4) {
      opacity: 1; transform: scale(1);
      transition: opacity 0.15s ease 0.30s, transform 0.15s cubic-bezier(0.34,1.56,0.64,1) 0.30s;
    }

    /* ── Background video ── */
    #bg-video {
      position: fixed;
      inset: 0;
      width: 100%; height: 100%;
      object-fit: cover;
      z-index: 1;
      opacity: 0;
      transition: opacity 0.5s ease;
      pointer-events: none;
    }
    #bg-video.playing { opacity: 1; }

    /* ── Charging case ── */
    .hero__case-wrap {
      position: absolute;
      top: 89%; left: 45%;
      transform: translateX(-50%);
      transition: opacity 0.2s ease, transform 0.2s ease;
      width: 45.07vw;   /* 56.34vw × 0.8 */
      height: 45.56vw;  /* 56.95vw × 0.8 */
      display: flex; align-items: center; justify-content: center;
      z-index: 4;
    }
    .hero__case-rotator {
      flex: none;
      transform: rotate(-90deg);
    }
    .hero__case-inner {
      width: 45.56vw;   /* 56.95vw × 0.8 */
      height: 45.07vw;  /* 56.34vw × 0.8 */
      position: relative;
      overflow: hidden;
    }
    .hero__case-inner img {
      position: absolute;
      width: 153.23%;
      height: 275.36%;
      left: -27.7%;
      top: -91.26%;
      max-width: none;
      pointer-events: none;
    }
  </style>
</head>
<body>

<!-- Full-screen background video -->
<video id="bg-video" muted playsinline preload="auto" loop>
  <source src="assets/NIKE.mp4" type="video/mp4">
</video>

<!-- ANNOUNCEMENT BAR -->
<div class="bar">
  Introducing PowerPlugs — health, customized, for you.&nbsp;<a href="#">Learn more</a>
</div>

<!-- HERO -->
<section class="hero">

  <!-- PRO title + tagline — scaled 50% both axes -->
  <div class="hero__titles">
    <div class="hero__logo">
      <img
        src="assets/images/ring-pro-logo.svg"
        alt="Ring PRO">
    </div>
    <p class="hero__tagline">Performance by design</p>
  </div>

  <!-- CTA -->
  <div class="hero__cta">
    <a href="#" class="btn-buy">BUY NOW</a>
  </div>

  <!-- Ring product image — sequence player -->
  <div class="hero__ring">
    <div class="hero__ring-inner">
      <canvas id="ring-seq"></canvas>
    </div>
  </div>

  <!-- Ring hover info: text + dots layer (difference blend) -->
  <div class="hover-text" id="hover-text">

    <!-- Dot + Ring PRO label row — flex for vertical centering -->
    <div class="hi-ring-row">
      <div class="hi-dot hi-dot-tl"></div>
      <p class="hi-ring-label">Ring PRO</p>
    </div>

    <!-- Spec texts — right side -->
    <div class="hi-specs">
      <p>-- Unibody titanium construction inspired by fighter jet materials.</p>
      <p>-- Uses Dual core chip and BLE 5.3 to track core athletic performance</p>
    </div>

    <!-- Accessories label — positioned above charger box -->
    <div class="hi-acc-header hi-acc-header-text">
      <div class="hi-dot-inline"></div>
      <span>Accessories</span>
    </div>

    <!-- Colours label — positioned above colour grid -->
    <p class="hi-colours-label hi-colours-label-text">Colours</p>

  </div>

  <!-- Ring hover info: boxes + images layer (no blend mode) -->
  <div class="hover-info" id="hover-info">

    <!-- Accessories — bottom-left -->
    <div class="hi-acc">
      <div class="hi-charger-box">
        <div class="hi-charger-img-area">
          <div class="hi-charger-rotator">
            <div class="hi-charger-clip">
              <img src="assets/images/charger.png" alt="Charger">
            </div>
          </div>
        </div>
        <div class="hi-charger-bar">
          <span>Charger</span>
          <span class="hi-charger-arrow">↗</span>
        </div>
      </div>
    </div>

    <!-- Colours — right side -->
    <div class="hi-colours">
      <div class="hi-colour-grid">
        <div class="hi-colour-item"><img src="assets/images/colour-gold.png" alt="Gold"></div>
        <div class="hi-colour-item"><img src="assets/images/colour-silver.png" alt="Silver"></div>
        <div class="hi-colour-item"><img src="assets/images/colour-black.png" alt="Black"></div>
        <div class="hi-colour-item"><img src="assets/images/colour-titanium.png" alt="Titanium"></div>
      </div>
    </div>

  </div>

  <!-- Charging case -->
  <div class="hero__case-wrap">
    <div class="hero__case-rotator">
      <div class="hero__case-inner">
        <img
          src="assets/images/charging-case.png"
          alt="Smart charging case">
      </div>
    </div>
  </div>

</section>

<div id="cursor"></div>
<div id="cursor-lines">
  <span class="line-left"></span>
  <span class="line-right"></span>
  <span class="line-up"></span>
  <span class="line-down"></span>
</div>

<script>
  const cursor      = document.getElementById('cursor');
  const cursorLines = document.getElementById('cursor-lines');
  const ring        = document.querySelector('.hero__ring');
  const chargerWrap = document.querySelector('.hero__case-wrap');
  const hoverInfo   = document.getElementById('hover-info');
  const hoverText   = document.getElementById('hover-text');
  const bgVideo     = document.getElementById('bg-video');
  const heroTitles  = document.querySelector('.hero__titles');


  const padX = 24, padY = 24;
  const DURATION = 400;
  const LERP = 0.08; // how fast the square chases the cursor (lower = slower)

  let isExpanded  = false;
  let isAnimating = false;

  // Normalized anchor: where within the square the cursor is (0=left/top, 1=right/bottom, 0.5=center)
  let anchorNX = 0.5, anchorNY = 0.5;
  // JS-tracked current square size
  let squareW = 20, squareH = 20;

  let lastMouseX = 0, lastMouseY = 0;
  // Smoothed (lerped) cursor position
  let smoothX = 0, smoothY = 0;
  let initialized = false;

  let collapseRafId = null;
  let resetTimeout  = null;
  let resetRafId    = null;

  // ── Text scramble engine ──────────────────────────────────────────────────
  const GLYPHS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!–#@';
  const TEXT_ANIMS = [
    { sel: '.hi-ring-label',                     delay:   0, dur: 280 },
    { sel: '.hi-acc-header span',                delay:  40, dur: 280 },
    { sel: '.hi-specs p:first-child',            delay:  60, dur: 280 },
    { sel: '.hi-specs p:last-child',             delay: 150, dur: 280 },
    { sel: '.hi-charger-bar > span:first-child', delay: 140, dur:  80 },
    { sel: '.hi-colours-label',                  delay:  40, dur: 280 },
  ];
  let scrambleTimers = [];

  function scrambleText(el, startDelay, totalDuration) {
    const text = el._orig !== undefined ? el._orig : el.textContent;
    el._orig = text;
    el.innerHTML = '';
    const animChars = [];
    for (let i = 0; i < text.length; i++) {
      const s = document.createElement('span');
      s.textContent = text[i];
      s.style.opacity = '0';
      el.appendChild(s);
      if (text[i] !== ' ') animChars.push({ span: s, char: text[i] });
    }
    const n = animChars.length;
    if (!n) return;
    const interval = totalDuration / n;
    animChars.forEach(({ span, char }, i) => {
      const t = startDelay + i * interval;
      // For slow-enough text, flash a random glyph just before the real char
      if (interval > 10) {
        const preT = Math.max(startDelay, t - Math.min(interval * 0.55, 55));
        const tid = setTimeout(() => {
          span.style.opacity = '1';
          span.textContent = GLYPHS[Math.floor(Math.random() * GLYPHS.length)];
        }, preT);
        scrambleTimers.push(tid);
      }
      const tid = setTimeout(() => {
        span.style.opacity = '1';
        span.textContent = char;
      }, t);
      scrambleTimers.push(tid);
    });
  }

  function startTextAnims() {
    TEXT_ANIMS.forEach(({ sel, delay, dur }) => {
      const el = document.querySelector(sel);
      if (el) scrambleText(el, delay, dur);
    });
  }

  function resetTextAnims() {
    scrambleTimers.forEach(id => clearTimeout(id));
    scrambleTimers = [];
    TEXT_ANIMS.forEach(({ sel }) => {
      const el = document.querySelector(sel);
      if (el && el._orig !== undefined) el.textContent = el._orig;
    });
  }

  // Persistent lerp loop — smoothly chases target when not in expand/collapse
  ;(function trackLoop() {
    if (!isExpanded && !collapseRafId) {
      const targetX = lastMouseX + (0.5 - anchorNX) * squareW;
      const targetY = lastMouseY + (0.5 - anchorNY) * squareH;
      smoothX += (targetX - smoothX) * LERP;
      smoothY += (targetY - smoothY) * LERP;
      cursor.style.left      = smoothX + 'px';
      cursor.style.top       = smoothY + 'px';
      cursorLines.style.left = smoothX + 'px';
      cursorLines.style.top  = smoothY + 'px';
    }
    requestAnimationFrame(trackLoop);
  }());

  function clearPendingReset() {
    if (resetTimeout) { clearTimeout(resetTimeout);        resetTimeout = null; }
    if (resetRafId)   { cancelAnimationFrame(resetRafId);  resetRafId   = null; }
    anchorNX = 0.5; anchorNY = 0.5;
    resetTextAnims();
    hoverInfo.classList.remove('active');
    hoverText.classList.remove('active');
  }

  function startReset() {
    const startNX = anchorNX, startNY = anchorNY;
    const t0 = performance.now();
    const dur = 500;
    function step(now) {
      const t     = Math.min((now - t0) / dur, 1);
      const eased = 1 - Math.pow(1 - t, 3); // ease-out cubic
      // Only update the anchor — lerp loop handles the actual cursor position
      anchorNX = startNX + (0.5 - startNX) * eased;
      anchorNY = startNY + (0.5 - startNY) * eased;
      if (t < 1) {
        resetRafId = requestAnimationFrame(step);
      } else {
        anchorNX = 0.5; anchorNY = 0.5;
        resetRafId = null;
      }
    }
    resetRafId = requestAnimationFrame(step);
  }

  function expand() {
    if (isAnimating) return;
    clearPendingReset();
    if (collapseRafId) { cancelAnimationFrame(collapseRafId); collapseRafId = null; }

    isExpanded  = true;
    isAnimating = true;

    const rect = ring.getBoundingClientRect();
    squareW = rect.width  + padX * 2;
    squareH = rect.height + padY * 2;

    cursor.style.transition = `width ${DURATION}ms ease, height ${DURATION}ms ease, left ${DURATION}ms ease, top ${DURATION}ms ease`;
    cursor.style.width  = squareW + 'px';
    cursor.style.height = squareH + 'px';
    cursor.style.left   = (rect.left + rect.width  / 2) + 'px';
    cursor.style.top    = (rect.top  + rect.height / 2) + 'px';

    cursorLines.querySelector('.line-left' ).style.transform = 'translateY(-50%) scaleX(0)';
    cursorLines.querySelector('.line-right').style.transform = 'translateY(-50%) scaleX(0)';
    cursorLines.querySelector('.line-up'   ).style.transform = 'translateX(-50%) scaleY(0)';
    cursorLines.querySelector('.line-down' ).style.transform = 'translateX(-50%) scaleY(0)';
    chargerWrap.style.opacity   = '0';
    chargerWrap.style.transform = 'translateX(-50%) translateY(30px)';
    hoverInfo.classList.add('active');
    hoverText.classList.add('active');
    startTextAnims();
    cursor.classList.add('expanded');
    heroTitles.classList.add('ring-hovered');
    seqPlaying  = true;
    seqLastTime = performance.now();
    bgVideo.play();
    bgVideo.classList.add('playing');

    setTimeout(() => { isAnimating = false; }, DURATION);
  }

  function collapse(cursorX, cursorY) {
    if (isAnimating) return;
    isExpanded  = false;
    isAnimating = true;

    // Anchor: where the cursor is within the expanded square (normalized 0–1)
    const rect = ring.getBoundingClientRect();
    const W = squareW, H = squareH;
    const squareLX = rect.left - padX;
    const squareLY = rect.top  - padY;
    anchorNX = Math.max(0, Math.min(1, (cursorX - squareLX) / W));
    anchorNY = Math.max(0, Math.min(1, (cursorY - squareLY) / H));

    const startW = W, startH = H;
    cursor.style.transition = ''; // rAF takes over

    cursorLines.querySelector('.line-left' ).style.transform = 'translateY(-50%) scaleX(1)';
    cursorLines.querySelector('.line-right').style.transform = 'translateY(-50%) scaleX(1)';
    cursorLines.querySelector('.line-up'   ).style.transform = 'translateX(-50%) scaleY(1)';
    cursorLines.querySelector('.line-down' ).style.transform = 'translateX(-50%) scaleY(1)';
    chargerWrap.style.opacity   = '1';
    chargerWrap.style.transform = 'translateX(-50%) translateY(0px)';
    resetTextAnims();
    hoverInfo.classList.remove('active');
    hoverText.classList.remove('active');
    cursor.classList.remove('expanded');
    heroTitles.classList.remove('ring-hovered');
    seqPlaying = false;
    bgVideo.classList.remove('playing');
    setTimeout(() => { bgVideo.pause(); }, 500);

    cursor.style.transition = 'none'; // rAF takes full control
    cursor.style.transition = 'none';
    const t0 = performance.now();
    function animateCollapse(now) {
      const t     = Math.min((now - t0) / DURATION, 1);
      // ease in-out quad
      const eased = t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2;

      squareW = startW + (20 - startW) * eased;
      squareH = startH + (20 - startH) * eased;

      const cx = lastMouseX + (0.5 - anchorNX) * squareW;
      const cy = lastMouseY + (0.5 - anchorNY) * squareH;
      cursor.style.width     = squareW + 'px';
      cursor.style.height    = squareH + 'px';
      cursor.style.left      = cx + 'px';
      cursor.style.top       = cy + 'px';
      cursorLines.style.left = cx + 'px';
      cursorLines.style.top  = cy + 'px';

      if (t < 1) {
        collapseRafId = requestAnimationFrame(animateCollapse);
      } else {
        squareW = 20; squareH = 20;
        cursor.style.width  = '20px';
        cursor.style.height = '20px';
        cursor.style.transition = '';
        // Sync lerp start position so it chases from the correct spot
        smoothX = lastMouseX + (0.5 - anchorNX) * squareW;
        smoothY = lastMouseY + (0.5 - anchorNY) * squareH;
        collapseRafId = null;
        isAnimating   = false;
        resetTimeout  = setTimeout(startReset, 1);
      }
    }
    collapseRafId = requestAnimationFrame(animateCollapse);
  }

  document.addEventListener('mousemove', e => {
    lastMouseX = e.clientX;
    lastMouseY = e.clientY;

    // Sync lerp start on first move so cursor doesn't slide in from (0,0)
    if (!initialized) {
      smoothX = e.clientX;
      smoothY = e.clientY;
      initialized = true;
    }

    const rect     = ring.getBoundingClientRect();
    const inBounds = e.clientX >= rect.left   - padX &&
                     e.clientX <= rect.right  + padX &&
                     e.clientY >= rect.top    - padY &&
                     e.clientY <= rect.bottom + padY;

    if (inBounds  && !isExpanded && !isAnimating) expand();
    if (!inBounds && isExpanded  && !isAnimating) collapse(e.clientX, e.clientY);

    // Lerp loop and collapse rAF handle both cursor and crosshair position
  });

  // ── Ring rotation sequence ───────────────────────────────────────────────
  const ringCanvas = document.getElementById('ring-seq');
  const ringCtx    = ringCanvas.getContext('2d');

  const SEQ_COUNT = 97;
  const SEQ_FPS   = 20;
  const SEQ_MS    = 1000 / SEQ_FPS;
  const SEQ_DIR   = 'assets/ring-sequence/Ring%20pro%20hero%20page_';

  // Set canvas buffer to 2× the container for crisp retina rendering
  (function sizeCanvas() {
    const r = document.querySelector('.hero__ring').getBoundingClientRect();
    ringCanvas.width  = Math.round(r.width  * 2);
    ringCanvas.height = Math.round(r.height * 2);
  })();

  const seqFrames = [];
  let seqLoaded   = 0;
  let seqCurFrame = 0;
  let seqLastTime = 0;
  let seqPlaying  = false;
  let seqDir      = 1; // 1 = forward, -1 = reverse

  function drawRingFrame(idx) {
    const img = seqFrames[idx];
    if (!img || !img.complete || !img.naturalWidth) return;
    const cw = ringCanvas.width, ch = ringCanvas.height;
    const iw = img.naturalWidth,  ih = img.naturalHeight;
    // contain: fit full frame, no cropping
    const scale = Math.min(cw / iw, ch / ih);
    const dw = iw * scale, dh = ih * scale;
    ringCtx.clearRect(0, 0, cw, ch);
    ringCtx.drawImage(img, (cw - dw) / 2, (ch - dh) / 2, dw, dh);
  }

  for (let i = 0; i < SEQ_COUNT; i++) {
    const img = new Image();
    img.onload = () => {
      seqLoaded++;
      if (seqLoaded === 1) drawRingFrame(0); // show first loaded frame immediately
    };
    img.src = SEQ_DIR + String(i).padStart(5, '0') + '.jpg';
    seqFrames.push(img);
  }

  ;(function seqLoop(now) {
    requestAnimationFrame(seqLoop);
    if (!seqPlaying || seqLoaded < 2) return;
    if (now - seqLastTime >= SEQ_MS) {
      seqLastTime = now;
      seqCurFrame += seqDir;
      if (seqCurFrame >= SEQ_COUNT - 1) { seqCurFrame = SEQ_COUNT - 1; seqDir = -1; }
      else if (seqCurFrame <= 0)         { seqCurFrame = 0;             seqDir =  1; }
      drawRingFrame(seqCurFrame);
    }
  }(0));
</script>

</body>
</html>
